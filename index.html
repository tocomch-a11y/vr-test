// --- 追加：ARモードに入った後に画面をタップすると音を強制的に出す ---
        window.onclick = () => {
            if (audio) {
                audio.play().then(() => {
                    console.log("Audio playing successfully");
                }).catch(e => {
                    console.log("Audio play failed:", e);
                });
            }
        };

        function render(time, frame) {
            if (!frame) return;
            hue += 0.005;

            // --- 重要：ここで常に音量のミュートを解除し、再生を試みる ---
            if (audio.srcObject && audio.paused) {
                audio.play().catch(() => { /* ユーザー操作待ち */ });
            }

            // 音のトリガーで形をランダム変更
            if (macData.trigger && (Date.now() - lastSwitch > 700)) {
                currentIdx = (currentIdx + 1) % geometries.length;
                mesh.geometry = geometries[currentIdx];
                lastSwitch = Date.now();
            }

            // ハンドトラッキング（手が認識されている時だけ吸い付く）
            const session = frame.session;
            let handDetected = false;
            for (const input of session.inputSources) {
                if (input.hand) {
                    const joint = input.hand.get('index-finger-tip');
                    const pose = frame.getJointPose(joint, xrRefSpace);
                    if (pose) {
                        mesh.position.lerp(new THREE.Vector3().copy(pose.transform.position), 0.15);
                        mesh.quaternion.slerp(new THREE.Quaternion().copy(pose.transform.orientation), 0.1);
                        handDetected = true;
                    }
                }
            }

            if (!handDetected) mesh.rotation.y += 0.01;

            const s = 1 + (macData.low * 2);
            mesh.scale.setScalar(s);
            mesh.material.color.setHSL((hue + macData.mid) % 1, 0.8, 0.5);

            renderer.render(scene, camera);
        }
