<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Mac Audio Sender - Stable</title>
    <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #111; color: white; text-align: center; padding-top: 50px; }
        button { padding: 20px; font-size: 20px; cursor: pointer; background: #00ff00; border-radius: 10px; }
        #link { margin-top: 20px; word-break: break-all; color: #00ffff; }
    </style>
</head>
<body>
    <h1>Mac音源 送信機</h1>
    <button id="startBtn">配信開始 (BlackHoleを選択)</button>
    <div id="status">Peer準備中...</div>
    <div id="link"></div>

    <script>
        // IDにランダムな数字を入れて競合を防ぐ
        const senderId = 'vr-audio-' + Math.floor(Math.random() * 9999);
        const peer = new Peer(senderId);

        peer.on('open', (id) => {
            document.getElementById('status').innerText = "送信機ID: " + id;
            // Questで開くべきURLを表示
            const questUrl = window.location.href.replace('sender.html', 'index.html') + '?id=' + id;
            document.getElementById('link').innerHTML = `QuestでこのURLを開いてください:<br><a href="${questUrl}" style="color:cyan">${questUrl}</a>`;
        });

        document.getElementById('startBtn').onclick = async () => {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            peer.on('call', call => {
                call.answer(stream);
                document.getElementById('status').innerText = "Questに送信中！";
            });
            document.getElementById('startBtn').style.display = 'none';
        };
    </script>
</body>
</html>
