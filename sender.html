<!DOCTYPE html>
<html>
<body style="background:#111; color:#0f0; text-align:center; padding:50px;">
    <button id="btn" style="padding:40px;">START SENDER</button>
    <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
    <script>
        const peer = new Peer('mac-sender-' + Math.floor(Math.random()*999));
        document.getElementById('btn').onclick = async () => {
            const stream = await navigator.mediaDevices.getUserMedia({ 
                audio: { echoCancellation: false, noiseSuppression: false, autoGainControl: false } 
            });
            const ctx = new AudioContext();
            const analyzer = ctx.createAnalyser();
            ctx.createMediaStreamSource(stream).connect(analyzer);
            const data = new Uint8Array(analyzer.frequencyBinCount);
            
            peer.call('quest-receiver', stream);
            const conn = peer.connect('quest-receiver');
            conn.on('open', () => {
                setInterval(() => {
                    analyzer.getByteFrequencyData(data);
                    conn.send({ low: data[4]/255, mid: data[15]/255, trigger: data[4]>215 });
                }, 20);
            });
        };
    </script>
</body>
</html>
